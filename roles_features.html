<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matriz de Permiss√µes - Din√¢mica</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        .header {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 10px 40px rgba(59, 130, 246, 0.3);
        }
        
        .header h1 {
            color: white;
            font-size: 28px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .header p {
            color: rgba(255,255,255,0.8);
            font-size: 14px;
        }
        
        .controls {
            display: flex;
            gap: 16px;
            margin-top: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .control-group label {
            color: rgba(255,255,255,0.7);
            font-size: 12px;
            font-weight: 500;
        }
        
        select, input[type="text"] {
            padding: 10px 14px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            font-size: 14px;
            background: rgba(255,255,255,0.1);
            color: white;
            min-width: 200px;
            transition: all 0.3s ease;
        }
        
        select:focus, input[type="text"]:focus {
            outline: none;
            border-color: #60a5fa;
            background: rgba(255,255,255,0.15);
        }
        
        select option {
            background: #1e293b;
            color: white;
        }
        
        input[type="text"]::placeholder {
            color: rgba(255,255,255,0.5);
        }
        
        .stats {
            display: flex;
            gap: 24px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 16px 24px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #60a5fa;
        }
        
        .stat-label {
            font-size: 12px;
            color: rgba(255,255,255,0.7);
            margin-top: 4px;
        }
        
        .table-container {
            background: white;
            border-radius: 16px;
            height: 100vh;
            overflow: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        th {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            padding: 16px 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 3px solid #3b82f6;
        }
        
        th:first-child {
            text-align: left;
            padding-left: 20px;
            min-width: 180px;
        }
        
        th:nth-child(2) {
            text-align: left;
            min-width: 100px;
        }
        
        td {
            padding: 12px 8px;
            text-align: center;
            border-bottom: 1px solid #e2e8f0;
            font-size: 13px;
            transition: all 0.2s ease;
        }
        
        #tableBody > tr > td  {
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            font-size: 13px;
            transition: all 0.2s ease;
        }

        td:first-child {
            text-align: center;
            font-weight: 600;
            color: #1e293b;
        }
        
        td:nth-child(2) {
            text-align: center;
            color: #64748b;
            font-weight: 500;
        }
        
        tbody tr:hover {
            background: #fef9c3 !important;
        }
        
        /* Cores alternadas por m√≥dulo */
        .module-row-0 { background: #f0f9ff; }
        .module-row-1 { background: #f0fdf4; }
        .module-row-2 { background: #fefce8; }
        .module-row-3 { background: #fdf4ff; }
        .module-row-4 { background: #fff7ed; }
        .module-row-5 { background: #f5f3ff; }
        .module-row-6 { background: #ecfeff; }
        .module-row-7 { background: #fef2f2; }
        
        /* Primeira linha de cada m√≥dulo */
        .module-first-row td {
            border-top: 3px solid #3b82f6;
        }
        
        .module-cell {
            position: relative;
        }
        
        .module-cell::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
        }
        
        .module-color-0 .module-cell::before { background: #3b82f6; }
        .module-color-1 .module-cell::before { background: #22c55e; }
        .module-color-2 .module-cell::before { background: #eab308; }
        .module-color-3 .module-cell::before { background: #a855f7; }
        .module-color-4 .module-cell::before { background: #f97316; }
        .module-color-5 .module-cell::before { background: #8b5cf6; }
        .module-color-6 .module-cell::before { background: #06b6d4; }
        .module-color-7 .module-cell::before { background: #ef4444; }
        
        .permission-dot {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            font-size: 14px;
            font-weight: bold;
            transition: transform 0.2s ease;
        }
        
        .permission-dot:hover {
            transform: scale(1.2);
        }
        
        .permission-yes {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.4);
        }
        
        .permission-no {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
        }
        
        .action-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .action-get { background: #dbeafe; color: #1d4ed8; }
        .action-add { background: #dcfce7; color: #166534; }
        .action-edit { background: #fef3c7; color: #92400e; }
        .action-delete { background: #fee2e2; color: #991b1b; }
        .action-other { background: #e2e8f0; color: #475569; }
        
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }
        
        .no-results i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        .json-info {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 8px;
            padding: 12px 16px;
            margin-top: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .json-info-icon {
            color: #22c55e;
            font-size: 18px;
        }
        
        .json-info-text {
            color: rgba(255,255,255,0.9);
            font-size: 13px;
        }
        
        .json-info-text strong {
            color: #22c55e;
        }

        /* Estilos para links de m√≥dulos */
        .module-link {
            color: #1e293b;
            text-decoration: none;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .module-link:hover {
            color: #3b82f6;
            text-decoration: underline;
        }
        
        .module-link-icon {
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .module-link:hover .module-link-icon {
            opacity: 1;
        }

        /* Responsivo */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 20px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            select, input[type="text"] {
                width: 100%;
            }
            
            .stats {
                justify-content: center;
            }
            
            th, td {
                padding: 8px 4px;
                font-size: 11px;
            }
            
            .permission-dot {
                width: 22px;
                height: 22px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê Matriz de Permiss√µes - Din√¢mica</h1>
            <p>Gerada automaticamente a partir do JSON de roles do banco de dados</p>
            
            <div class="controls">
                <div class="control-group">
                    <label>Filtrar por M√≥dulo</label>
                    <select id="moduleFilter">
                        <option value="all">Todos os m√≥dulos</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>Filtrar por Role</label>
                    <select id="roleFilter">
                        <option value="all">Todas as roles</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>Buscar permiss√£o</label>
                    <input type="text" id="searchInput" placeholder="Ex: patient_get, clinic...">
                </div>
            </div>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalRoles">0</div>
                    <div class="stat-label">Roles</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalModules">0</div>
                    <div class="stat-label">M√≥dulos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalPermissions">0</div>
                    <div class="stat-label">Permiss√µes √önicas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalAssignments">0</div>
                    <div class="stat-label">Atribui√ß√µes</div>
                </div>
            </div>
            
            <div class="json-info">
                <span class="json-info-icon">‚úì</span>
                <span class="json-info-text">
                    JSON carregado: <strong id="jsonDate">sys_role_202601101753.json</strong> 
                    ‚Äî Para atualizar, substitua o objeto <code>rolesData</code> no c√≥digo.
                </span>
            </div>
        </div>
        
        <div class="table-container">
            <table>
                <thead>
                    <tr id="tableHeader"></tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        // ============================================================
        // JSON DO BANCO DE DADOS - COLE AQUI O NOVO JSON QUANDO ATUALIZAR
        // ============================================================
        const rolesData = {
            "sys_role": [
                {
                    "id": 1,
                    "name": "Root",
                    "status": "A",
                    "authorities": "clinic_get,clinic_add,clinic_edit,clinic_delete,user_get,user_add,user_edit,user_delete,unit_get,unit_add,unit_edit,unit_delete,patient_list,patient_ia,patient_get,patient_add,patient_edit,patient_delete,patient_documents,service_provider_get,dynamic_fields_get,dynamic_fields_add,dynamic_fields_edit,dynamic_fields_delete,service_provider_add,service_provider_edit,service_provider_delete,service_provider_all,service_provider_salary_get,service_provider_salary_edit,responsible_get,permissions_get,permissions_edit,clinic_settings_get,clinic_settings_add,clinic_settings_edit,clinic_settings_delete,system_help_get,standard_criteria_get,standard_criteria_add,standard_criteria_edit,standard_criteria_delete,standard_schedules_get,standard_schedules_add,standard_schedules_edit,standard_schedules_delete,form_get,form_add,form_edit,form_delete,patient_form_get,patient_form_add,patient_form_edit,patient_form_delete,form_answer_add,form_answer_edit,objectives_get,objectives_add,objectives_edit,objectives_delete,appointment_get,appointment_add,appointment_edit,appointment_cancel,hours_control_get,hours_control_report,timesheet_get,email_control_get,ia_control_get,ia_get,response_form_get,response_form_add,attendance_get,attendance_add,attendance_edit,attendance_delete,attendance_aba_get,attendance_aba_add,attendance_aba_edit,attendance_aba_delete,evaluation_get,evaluation_add,evaluation_edit,evaluation_delete,evolution_get,report_get,meeting_minutes_get,meeting_minutes_add,meeting_minutes_edit,meeting_minutes_delete,unit_all,hash_get,supervision_add,supervision_get,supervision_edit,supervision_delete,therapeutic_plan_add,therapeutic_plan_get,therapeutic_plan_edit,therapeutic_plan_delete,config_session_add,config_session_get,config_session_edit,config_session_delete",
                    "root": 1
                },
                {
                    "id": 2,
                    "name": "Admin",
                    "status": "A",
                    "authorities": "clinic_get,clinic_add,clinic_edit,clinic_delete,user_get,user_add,user_edit,user_delete,unit_get,unit_add,unit_edit,unit_delete,patient_list,patient_ia,patient_get,patient_add,patient_edit,patient_delete,patient_documents,service_provider_get,dynamic_fields_get,dynamic_fields_add,dynamic_fields_edit,dynamic_fields_delete,service_provider_add,service_provider_edit,service_provider_delete,service_provider_all,service_provider_salary_get,service_provider_salary_edit,responsible_get,permissions_get,permissions_edit,standard_criteria_get,standard_criteria_add,standard_criteria_edit,standard_criteria_delete,standard_schedules_get,standard_schedules_add,standard_schedules_edit,standard_schedules_delete,form_get,form_add,form_edit,form_delete,objectives_get,objectives_add,objectives_edit,objectives_delete,appointment_get,appointment_add,appointment_edit,appointment_cancel,hours_control_get,hours_control_report,timesheet_get,ia_get,response_form_get,response_form_add,attendance_get,attendance_add,attendance_edit,attendance_delete,attendance_aba_get,attendance_aba_add,attendance_aba_edit,attendance_aba_delete,evaluation_get,evaluation_add,evaluation_edit,evaluation_delete,report_get,meeting_minutes_get,meeting_minutes_add,meeting_minutes_edit,meeting_minutes_delete,unit_all,bug_suggestion_get,bug_suggestion_add,bug_suggestion_edit,bug_suggestion_delete,bug_suggestion_comment_add,bug_suggestion_like,supervision_add,supervision_get,supervision_edit,supervision_delete,therapeutic_plan_add,therapeutic_plan_get,therapeutic_plan_edit,therapeutic_plan_delete,config_session_add,config_session_get,config_session_edit,config_session_delete",
                    "root": 0
                },
                {
                    "id": 3,
                    "name": "Administrativo",
                    "status": "A",
                    "authorities": "user_get,user_add,user_edit,user_delete,unit_get,unit_add,unit_edit,unit_delete,patient_list,patient_ia,patient_get,patient_add,patient_edit,patient_delete,patient_documents,service_provider_get,dynamic_fields_get,dynamic_fields_add,dynamic_fields_edit,dynamic_fields_delete,service_provider_add,service_provider_edit,service_provider_delete,service_provider_all,service_provider_salary_get,service_provider_salary_edit,responsible_get,permissions_get,permissions_edit,standard_schedules_get,standard_schedules_add,standard_schedules_edit,standard_schedules_delete,appointment_get,appointment_add,appointment_edit,appointment_cancel,hours_control_get,hours_control_report,timesheet_get",
                    "root": 0
                },
                {
                    "id": 4,
                    "name": "Coordenador",
                    "status": "A",
                    "authorities": "user_get,user_add,user_edit,user_delete,unit_get,unit_add,unit_edit,unit_delete,patient_list,patient_ia,patient_get,patient_add,patient_edit,patient_delete,patient_documents,service_provider_get,dynamic_fields_get,dynamic_fields_add,dynamic_fields_edit,dynamic_fields_delete,service_provider_add,service_provider_edit,service_provider_delete,service_provider_salary_get,service_provider_salary_edit,responsible_get,standard_criteria_get,standard_criteria_add,standard_criteria_edit,standard_criteria_delete,standard_schedules_get,standard_schedules_add,standard_schedules_edit,standard_schedules_delete,form_get,form_add,form_edit,form_delete,patient_form_get,patient_form_add,patient_form_edit,patient_form_delete,form_answer_add,form_answer_edit,objectives_get,objectives_add,objectives_edit,objectives_delete,appointment_get,appointment_add,appointment_edit,appointment_cancel,hours_control_get,hours_control_report,timesheet_get,ia_get,response_form_get,response_form_add,attendance_get,attendance_add,attendance_edit,attendance_delete,attendance_aba_get,attendance_aba_add,attendance_aba_edit,attendance_aba_delete,evaluation_get,evaluation_add,evaluation_edit,evaluation_delete,report_get,meeting_minutes_get,meeting_minutes_add,meeting_minutes_edit,meeting_minutes_delete,supervision_add,supervision_get,supervision_edit,supervision_delete,therapeutic_plan_add,therapeutic_plan_get,therapeutic_plan_edit,therapeutic_plan_delete,config_session_add,config_session_get,config_session_edit,config_session_delete",
                    "root": 0
                },
                {
                    "id": 5,
                    "name": "Supervisor",
                    "status": "A",
                    "authorities": "user_get,user_add,user_edit,user_delete,unit_get,unit_add,unit_edit,unit_delete,patient_list,patient_ia,patient_get,patient_add,patient_edit,patient_delete,patient_documents,service_provider_get,dynamic_fields_get,dynamic_fields_add,dynamic_fields_edit,dynamic_fields_delete,service_provider_add,service_provider_edit,service_provider_delete,responsible_get,standard_criteria_get,standard_criteria_add,standard_criteria_edit,standard_criteria_delete,standard_schedules_get,standard_schedules_add,standard_schedules_edit,standard_schedules_delete,form_get,form_add,form_edit,form_delete,patient_form_get,patient_form_add,patient_form_edit,patient_form_delete,form_answer_add,form_answer_edit,objectives_get,objectives_add,objectives_edit,objectives_delete,appointment_get,appointment_add,appointment_edit,hours_control_get,hours_control_report,timesheet_get,ia_get,response_form_get,response_form_add,attendance_get,attendance_add,attendance_edit,attendance_delete,attendance_aba_get,attendance_aba_add,attendance_aba_edit,attendance_aba_delete,evaluation_get,evaluation_add,evaluation_edit,evaluation_delete,report_get,meeting_minutes_get,meeting_minutes_add,meeting_minutes_edit,meeting_minutes_delete,supervision_add,supervision_get,supervision_edit,supervision_delete,therapeutic_plan_add,therapeutic_plan_get,therapeutic_plan_edit,therapeutic_plan_delete,config_session_add,config_session_get,config_session_edit,config_session_delete",
                    "root": 0
                },
                {
                    "id": 6,
                    "name": "Terapeuta ABA",
                    "status": "A",
                    "authorities": "user_get,user_add,user_edit,user_delete,patient_get,patient_add,patient_edit,patient_delete,patient_documents,service_provider_get,unit_get,patient_list,patient_ia,form_get,form_add,form_edit,form_delete,patient_form_get,patient_form_add,patient_form_edit,patient_form_delete,form_answer_add,form_answer_edit,objectives_get,objectives_add,appointment_get,appointment_add,appointment_edit,timesheet_get,ia_get,response_form_get,response_form_add,attendance_get,attendance_add,attendance_edit,attendance_delete,attendance_aba_get,attendance_aba_add,attendance_aba_edit,attendance_aba_delete,evaluation_get,evaluation_add,evaluation_edit,evaluation_delete,report_get,meeting_minutes_get,meeting_minutes_add,meeting_minutes_edit,meeting_minutes_delete,supervision_add,supervision_get,supervision_edit,supervision_delete,therapeutic_plan_add,therapeutic_plan_get,therapeutic_plan_edit,therapeutic_plan_delete,config_session_add,config_session_get,config_session_edit,config_session_delete",
                    "root": 0
                },
                {
                    "id": 7,
                    "name": "Terapeuta Ocupacional",
                    "status": "A",
                    "authorities": "user_get,user_add,user_edit,user_delete,patient_get,patient_add,patient_edit,patient_delete,patient_documents,service_provider_get,unit_get,patient_list,patient_ia,form_get,form_add,form_edit,form_delete,patient_form_get,patient_form_add,patient_form_edit,patient_form_delete,form_answer_add,form_answer_edit,objectives_get,objectives_add,appointment_get,appointment_add,appointment_edit,timesheet_get,ia_get,response_form_get,response_form_add,attendance_get,attendance_add,attendance_edit,attendance_delete,attendance_aba_get,attendance_aba_add,attendance_aba_edit,attendance_aba_delete,evaluation_get,evaluation_add,evaluation_edit,evaluation_delete,report_get,meeting_minutes_get,meeting_minutes_add,meeting_minutes_edit,meeting_minutes_delete,supervision_add,supervision_get,supervision_edit,supervision_delete,therapeutic_plan_add,therapeutic_plan_get,therapeutic_plan_edit,therapeutic_plan_delete,config_session_add,config_session_get,config_session_edit,config_session_delete",
                    "root": 0
                },
                {
                    "id": 8,
                    "name": "Fonoaudi√≥logo",
                    "status": "A",
                    "authorities": "user_get,user_add,user_edit,user_delete,patient_get,patient_add,patient_edit,patient_delete,patient_documents,service_provider_get,unit_get,patient_list,patient_ia,form_get,form_add,form_edit,form_delete,patient_form_get,patient_form_add,patient_form_edit,patient_form_delete,form_answer_add,form_answer_edit,objectives_get,objectives_add,appointment_get,appointment_add,appointment_edit,timesheet_get,ia_get,response_form_get,response_form_add,attendance_get,attendance_add,attendance_edit,attendance_delete,attendance_aba_get,attendance_aba_add,attendance_aba_edit,attendance_aba_delete,evaluation_get,evaluation_add,evaluation_edit,evaluation_delete,report_get,meeting_minutes_get,meeting_minutes_add,meeting_minutes_edit,meeting_minutes_delete,supervision_add,supervision_get,supervision_edit,supervision_delete,therapeutic_plan_add,therapeutic_plan_get,therapeutic_plan_edit,therapeutic_plan_delete,config_session_add,config_session_get,config_session_edit,config_session_delete",
                    "root": 0
                },
                {
                    "id": 9,
                    "name": "Neuropsic√≥logo",
                    "status": "A",
                    "authorities": "user_get,user_add,user_edit,user_delete,patient_get,patient_add,patient_edit,patient_delete,patient_documents,service_provider_get,unit_get,patient_list,patient_ia,form_get,form_add,form_edit,form_delete,patient_form_get,patient_form_add,patient_form_edit,patient_form_delete,form_answer_add,form_answer_edit,objectives_get,objectives_add,appointment_get,appointment_add,appointment_edit,timesheet_get,ia_get,response_form_get,response_form_add,attendance_get,attendance_add,attendance_edit,attendance_delete,attendance_aba_get,attendance_aba_add,attendance_aba_edit,attendance_aba_delete,evaluation_get,evaluation_add,evaluation_edit,evaluation_delete,report_get,meeting_minutes_get,meeting_minutes_add,meeting_minutes_edit,meeting_minutes_delete,supervision_add,supervision_get,supervision_edit,supervision_delete,therapeutic_plan_add,therapeutic_plan_get,therapeutic_plan_edit,therapeutic_plan_delete,config_session_add,config_session_get,config_session_edit,config_session_delete",
                    "root": 0
                },
                {
                    "id": 10,
                    "name": "Psicopedagogo",
                    "status": "A",
                    "authorities": "user_get,user_add,user_edit,user_delete,patient_get,patient_add,patient_edit,patient_delete,patient_documents,service_provider_get,unit_get,patient_list,patient_ia,form_get,form_add,form_edit,form_delete,patient_form_get,patient_form_add,patient_form_edit,patient_form_delete,form_answer_add,form_answer_edit,objectives_get,objectives_add,appointment_get,appointment_add,appointment_edit,timesheet_get,ia_get,response_form_get,response_form_add,attendance_get,attendance_add,attendance_edit,attendance_delete,attendance_aba_get,attendance_aba_add,attendance_aba_edit,attendance_aba_delete,evaluation_get,evaluation_add,evaluation_edit,evaluation_delete,report_get,meeting_minutes_get,meeting_minutes_add,meeting_minutes_edit,meeting_minutes_delete,supervision_add,supervision_get,supervision_edit,supervision_delete,therapeutic_plan_add,therapeutic_plan_get,therapeutic_plan_edit,therapeutic_plan_delete,config_session_add,config_session_get,config_session_edit,config_session_delete",
                    "root": 0
                },
                {
                    "id": 11,
                    "name": "Musicoterapeuta",
                    "status": "A",
                    "authorities": "user_get,user_add,user_edit,user_delete,patient_get,patient_add,patient_edit,patient_delete,patient_documents,service_provider_get,unit_get,patient_list,patient_ia,form_get,form_add,form_edit,form_delete,patient_form_get,patient_form_add,patient_form_edit,patient_form_delete,form_answer_add,form_answer_edit,objectives_get,objectives_add,appointment_get,appointment_add,appointment_edit,timesheet_get,ia_get,response_form_get,response_form_add,attendance_get,attendance_add,attendance_edit,attendance_delete,attendance_aba_get,attendance_aba_add,attendance_aba_edit,attendance_aba_delete,evaluation_get,evaluation_add,evaluation_edit,evaluation_delete,report_get,meeting_minutes_get,meeting_minutes_add,meeting_minutes_edit,meeting_minutes_delete,supervision_add,supervision_get,supervision_edit,supervision_delete,therapeutic_plan_add,therapeutic_plan_get,therapeutic_plan_edit,therapeutic_plan_delete,config_session_add,config_session_get,config_session_edit,config_session_delete",
                    "root": 0
                },
                {
                    "id": 12,
                    "name": "Nutricionista",
                    "status": "A",
                    "authorities": "user_get,user_add,user_edit,user_delete,patient_get,patient_add,patient_edit,patient_delete,patient_documents,service_provider_get,unit_get,patient_list,patient_ia,form_get,form_add,form_edit,form_delete,patient_form_get,patient_form_add,patient_form_edit,patient_form_delete,form_answer_add,form_answer_edit,objectives_get,objectives_add,appointment_get,appointment_add,appointment_edit,timesheet_get,ia_get,response_form_get,response_form_add,attendance_get,attendance_add,attendance_edit,attendance_delete,attendance_aba_get,attendance_aba_add,attendance_aba_edit,attendance_aba_delete,evaluation_get,evaluation_add,evaluation_edit,evaluation_delete,report_get,meeting_minutes_get,meeting_minutes_add,meeting_minutes_edit,meeting_minutes_delete,supervision_add,supervision_get,supervision_edit,supervision_delete,therapeutic_plan_add,therapeutic_plan_get,therapeutic_plan_edit,therapeutic_plan_delete,config_session_add,config_session_get,config_session_edit,config_session_delete",
                    "root": 0
                },
                {
                    "id": 13,
                    "name": "Respons√°vel",
                    "status": "A",
                    "authorities": "report_get,patient_get",
                    "root": 0
                }
            ]
        };
        // ============================================================
        // FIM DO JSON - N√ÉO MODIFIQUE ABAIXO DESTA LINHA
        // ============================================================

        // Configura√ß√£o de nomes amig√°veis para m√≥dulos COM LINKS
        // Estrutura: { name: 'Nome do M√≥dulo', link: 'URL do m√≥dulo' }
        // Se n√£o quiser link, deixe link como null ou string vazia
        const moduleNames = {
            'clinic': { name: 'Cl√≠nica', link: '/clinics' },
            'user': { name: 'Usu√°rio' },
            'unit': { name: 'Unidade', link: '/units' },
            'patient': { name: 'Paciente', link: '/patients' },
            'service_provider': { name: 'Prestador de Servi√ßo', link: '/serviceprovider' },
            'service_provider_salary': { name: 'Sal√°rio do Prestador'},
            'dynamic_fields': { name: 'Campos Din√¢micos', link: '/dynamic-fields' },
            'responsible': { name: 'Respons√°vel', link: '/responsibles' },
            'permissions': { name: 'Permiss√µes' },
            'clinic_settings': { name: 'Config. da Cl√≠nica', link: '/clinic-settings' },
            'system_help': { name: 'Ajuda do Sistema', link: '/help' },
            'standard_criteria': { name: 'Crit√©rios Padr√£o', link: '/standard-criteria' },
            'standard_schedules': { name: 'Agendamentos Padr√£o', link: '/standard-schedules' },
            'form': { name: 'Formul√°rio', link: '/forms' },
            'patient_form': { name: 'Formul√°rio do Paciente', link: '/response-form' },
            'form_answer': { name: 'Resposta de Formul√°rio', link: '/form-answers' },
            'objectives': { name: 'Objetivos' },
            'appointment': { name: 'Agendamento', link: '/agenda' },
            'hours_control': { name: 'Controle de Horas', link: '/hours-control' },
            'timesheet': { name: 'Folha de Ponto' },
            'email_control': { name: 'Controle de Email'},
            'ia_control': { name: 'Controle de IA'},
            'ia': { name: 'IA' },
            'response_form': { name: 'Formul√°rio de Resposta', link: '/response-form' },
            'attendance': { name: 'Atendimento', link: '/attendances' },
            'attendance_aba': { name: 'Atendimento ABA' },
            'evaluation': { name: 'Avalia√ß√£o', link: '/evaluations' },
            'evolution': { name: 'Evolu√ß√£o' },
            'report': { name: 'Relat√≥rio' },
            'meeting_minutes': { name: 'Ata de Reuni√£o', link: '/meeting-minutes' },
            'hash': { name: 'Hash' },
            'bug_suggestion': { name: 'Bug/Sugest√£o' },
            'supervision': { name: 'Supervis√£o', link: '/supervision' },
            'therapeutic_plan': { name: 'Plano Terap√™utico', link: '/therapeutic-plan' },
            'config_session': { name: 'Config. de Sess√£o', link: '/config-session' }
        };

        // Fun√ß√£o auxiliar para obter o nome do m√≥dulo
        function getModuleName(key) {
            if (moduleNames[key]) {
                return typeof moduleNames[key] === 'object' ? moduleNames[key].name : moduleNames[key];
            }
            return formatModuleName(key);
        }

        // Fun√ß√£o auxiliar para obter o link do m√≥dulo
        function getModuleLink(key) {
            if (moduleNames[key] && typeof moduleNames[key] === 'object') {
                return moduleNames[key].link || null;
            }
            return null;
        }

        // Nomes amig√°veis para a√ß√µes
        const actionNames = {
            'get': 'Visualizar',
            'add': 'Adicionar',
            'edit': 'Editar',
            'delete': 'Excluir',
            'cancel': 'Cancelar',
            'all': 'Todos',
            'list': 'Listar',
            'ia': 'IA',
            'documents': 'Documentos',
            'report': 'Relat√≥rio',
            'comment_add': 'Add Coment√°rio',
            'like': 'Curtir'
        };

        // Ordem preferencial dos m√≥dulos
        const moduleOrder = [
            'clinic', 'user', 'unit', 'patient', 'service_provider', 'service_provider_salary',
            'dynamic_fields', 'responsible', 'permissions', 'clinic_settings', 'system_help',
            'standard_criteria', 'standard_schedules', 'form', 'patient_form', 'form_answer',
            'objectives', 'appointment', 'hours_control', 'timesheet', 'email_control',
            'ia_control', 'ia', 'response_form', 'attendance', 'attendance_aba',
            'evaluation', 'evolution', 'report', 'meeting_minutes', 'supervision',
            'therapeutic_plan', 'config_session', 'hash', 'bug_suggestion'
        ];

        // Vari√°veis globais
        let roles = [];
        let modules = {};
        let allPermissions = new Set();

        // Processar o JSON e extrair estrutura
        function processJsonData() {
            roles = rolesData.sys_role.filter(r => r.status === 'A');
            
            // Extrair todas as permiss√µes √∫nicas e organizar por m√≥dulo
            roles.forEach(role => {
                const authorities = role.authorities ? role.authorities.split(',') : [];
                authorities.forEach(auth => {
                    allPermissions.add(auth);
                    
                    // Extrair m√≥dulo e a√ß√£o
                    const parts = auth.split('_');
                    let moduleName, action;
                    
                    // Lidar com m√≥dulos compostos (ex: service_provider_salary_get)
                    if (parts.length >= 3) {
                        // Tentar encontrar m√≥dulo composto
                        for (let i = parts.length - 1; i >= 1; i--) {
                            const possibleModule = parts.slice(0, i).join('_');
                            const possibleAction = parts.slice(i).join('_');
                            
                            if (actionNames[possibleAction] || ['get', 'add', 'edit', 'delete', 'cancel', 'all', 'list', 'report'].includes(possibleAction)) {
                                moduleName = possibleModule;
                                action = possibleAction;
                                break;
                            }
                        }
                        
                        if (!moduleName) {
                            moduleName = parts.slice(0, -1).join('_');
                            action = parts[parts.length - 1];
                        }
                    } else if (parts.length === 2) {
                        moduleName = parts[0];
                        action = parts[1];
                    } else {
                        moduleName = auth;
                        action = 'access';
                    }
                    
                    if (!modules[moduleName]) {
                        modules[moduleName] = {
                            name: getModuleName(moduleName),
                            link: getModuleLink(moduleName),
                            key: moduleName,
                            actions: new Set(),
                            permissions: {}
                        };
                        roles.forEach(r => {
                            modules[moduleName].permissions[r.name] = {};
                        });
                    }
                    
                    modules[moduleName].actions.add(action);
                });
            });
            
            // Preencher matriz de permiss√µes
            roles.forEach(role => {
                const authorities = role.authorities ? role.authorities.split(',') : [];
                authorities.forEach(auth => {
                    const parts = auth.split('_');
                    let moduleName, action;
                    
                    if (parts.length >= 3) {
                        for (let i = parts.length - 1; i >= 1; i--) {
                            const possibleModule = parts.slice(0, i).join('_');
                            const possibleAction = parts.slice(i).join('_');
                            
                            if (actionNames[possibleAction] || ['get', 'add', 'edit', 'delete', 'cancel', 'all', 'list', 'report'].includes(possibleAction)) {
                                moduleName = possibleModule;
                                action = possibleAction;
                                break;
                            }
                        }
                        
                        if (!moduleName) {
                            moduleName = parts.slice(0, -1).join('_');
                            action = parts[parts.length - 1];
                        }
                    } else if (parts.length === 2) {
                        moduleName = parts[0];
                        action = parts[1];
                    } else {
                        moduleName = auth;
                        action = 'access';
                    }
                    
                    if (modules[moduleName] && modules[moduleName].permissions[role.name]) {
                        modules[moduleName].permissions[role.name][action] = true;
                    }
                });
            });
            
            // Converter Sets para Arrays e ordenar a√ß√µes
            Object.keys(modules).forEach(key => {
                modules[key].actions = Array.from(modules[key].actions).sort((a, b) => {
                    const order = ['get', 'list', 'add', 'edit', 'delete', 'cancel', 'all'];
                    const aIdx = order.indexOf(a);
                    const bIdx = order.indexOf(b);
                    if (aIdx === -1 && bIdx === -1) return a.localeCompare(b);
                    if (aIdx === -1) return 1;
                    if (bIdx === -1) return -1;
                    return aIdx - bIdx;
                });
            });
        }

        // Formatar nome do m√≥dulo
        function formatModuleName(key) {
            return key.split('_').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }

        // Obter classe CSS para a√ß√£o
        function getActionClass(action) {
            if (action === 'get' || action === 'list') return 'action-get';
            if (action === 'add') return 'action-add';
            if (action === 'edit') return 'action-edit';
            if (action === 'delete' || action === 'cancel') return 'action-delete';
            return 'action-other';
        }

        // Abreviar nome da role para caber no header
        function abbreviateRoleName(name) {
            const abbreviations = {
                'Terapeuta ABA': 'Ter. ABA',
                'Terapeuta Ocupacional': 'Ter. Ocup.',
                'Fonoaudi√≥logo': 'Fono',
                'Neuropsic√≥logo': 'Neuro',
                'Psicopedagogo': 'Psicoped.',
                'Musicoterapeuta': 'Music.',
                'Nutricionista': 'Nutri.',
                'Administrativo': 'Admin.',
                'Coordenador': 'Coord.',
                'Supervisor': 'Superv.',
                'Respons√°vel': 'Resp.'
            };
            return abbreviations[name] || name;
        }

        // Renderizar tabela
        function renderTable(moduleFilter = 'all', roleFilter = 'all', searchTerm = '') {
            const header = document.getElementById('tableHeader');
            const body = document.getElementById('tableBody');
            
            // Filtrar roles
            let filteredRoles = roles;
            if (roleFilter !== 'all') {
                filteredRoles = roles.filter(r => r.name === roleFilter);
            }
            
            // Renderizar header
            header.innerHTML = '<th>M√≥dulo</th><th>A√ß√£o</th>' + 
                filteredRoles.map(role => `<th title="${role.name}">${abbreviateRoleName(role.name)}</th>`).join('');
            
            // Ordenar m√≥dulos
            const sortedModules = Object.keys(modules).sort((a, b) => {
                const aIdx = moduleOrder.indexOf(a);
                const bIdx = moduleOrder.indexOf(b);
                if (aIdx === -1 && bIdx === -1) return a.localeCompare(b);
                if (aIdx === -1) return 1;
                if (bIdx === -1) return -1;
                return aIdx - bIdx;
            });
            
            // Filtrar m√≥dulos
            let filteredModules = sortedModules;
            if (moduleFilter !== 'all') {
                filteredModules = sortedModules.filter(m => m === moduleFilter);
            }
            
            // Filtrar por busca
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                filteredModules = filteredModules.filter(moduleKey => {
                    const module = modules[moduleKey];
                    return moduleKey.toLowerCase().includes(term) ||
                           module.name.toLowerCase().includes(term) ||
                           module.actions.some(a => a.toLowerCase().includes(term));
                });
            }
            
            // Renderizar body
            body.innerHTML = '';
            let moduleIndex = 0;
            let totalAssignments = 0;
            
            filteredModules.forEach(moduleKey => {
                const module = modules[moduleKey];
                const colorIndex = moduleIndex % 8;
                
                module.actions.forEach((action, actionIdx) => {
                    const row = document.createElement('tr');
                    row.className = `module-row-${colorIndex} module-color-${colorIndex}`;
                    
                    if (actionIdx === 0) {
                        row.classList.add('module-first-row');
                    }
                    
                    // C√©lula do m√≥dulo (apenas na primeira linha)
                    if (actionIdx === 0) {
                        const moduleCell = document.createElement('td');
                        moduleCell.rowSpan = module.actions.length;
                        moduleCell.className = 'module-cell';
                        
                        // Verificar se tem link
                        if (module.link) {
                            moduleCell.innerHTML = `
                                <a href="https://app.nonprod.elo-clinic.com${module.link}" class="module-link" target="_blank" title="Abrir ${module.name}">
                                    <strong>${module.name}</strong>
                                    <span class="module-link-icon">üîó</span>
                                </a>
                                <br><small style="color:#64748b">${moduleKey}</small>
                            `;
                        } else {
                            moduleCell.innerHTML = `<strong>${module.name}</strong><br><small style="color:#64748b">${moduleKey}</small>`;
                        }
                        
                        row.appendChild(moduleCell);
                    }
                    
                    // C√©lula da a√ß√£o
                    const actionCell = document.createElement('td');
                    const actionLabel = actionNames[action] || action;
                    actionCell.innerHTML = `<span class="action-badge ${getActionClass(action)}">${actionLabel}</span>`;
                    row.appendChild(actionCell);
                    
                    // C√©lulas de permiss√µes
                    filteredRoles.forEach(role => {
                        const permCell = document.createElement('td');
                        const hasPermission = module.permissions[role.name] && module.permissions[role.name][action];
                        
                        if (hasPermission) totalAssignments++;
                        
                        permCell.innerHTML = `<span class="permission-dot ${hasPermission ? 'permission-yes' : 'permission-no'}" 
                            title="${role.name}: ${hasPermission ? 'Sim' : 'N√£o'}">
                            ${hasPermission ? '‚úì' : '‚úó'}
                        </span>`;
                        row.appendChild(permCell);
                    });
                    
                    body.appendChild(row);
                });
                
                moduleIndex++;
            });
            
            // Atualizar estat√≠sticas
            document.getElementById('totalAssignments').textContent = totalAssignments;
            
            // Mostrar mensagem se n√£o houver resultados
            if (filteredModules.length === 0) {
                body.innerHTML = `
                    <tr>
                        <td colspan="${filteredRoles.length + 2}" class="no-results">
                            <div>üîç</div>
                            <p>Nenhum resultado encontrado</p>
                        </td>
                    </tr>
                `;
            }
        }

        // Inicializar filtros
        function initFilters() {
            const moduleSelect = document.getElementById('moduleFilter');
            const roleSelect = document.getElementById('roleFilter');
            const searchInput = document.getElementById('searchInput');
            
            // Popular filtro de m√≥dulos
            const sortedModules = Object.keys(modules).sort((a, b) => {
                const aIdx = moduleOrder.indexOf(a);
                const bIdx = moduleOrder.indexOf(b);
                if (aIdx === -1 && bIdx === -1) return a.localeCompare(b);
                if (aIdx === -1) return 1;
                if (bIdx === -1) return -1;
                return aIdx - bIdx;
            });
            
            sortedModules.forEach(key => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = modules[key].name;
                moduleSelect.appendChild(option);
            });
            
            // Popular filtro de roles
            roles.forEach(role => {
                const option = document.createElement('option');
                option.value = role.name;
                option.textContent = role.name;
                roleSelect.appendChild(option);
            });
            
            // Event listeners
            moduleSelect.addEventListener('change', () => {
                renderTable(moduleSelect.value, roleSelect.value, searchInput.value);
            });
            
            roleSelect.addEventListener('change', () => {
                renderTable(moduleSelect.value, roleSelect.value, searchInput.value);
            });
            
            searchInput.addEventListener('input', () => {
                renderTable(moduleSelect.value, roleSelect.value, searchInput.value);
            });
        }

        // Atualizar estat√≠sticas
        function updateStats() {
            document.getElementById('totalRoles').textContent = roles.length;
            document.getElementById('totalModules').textContent = Object.keys(modules).length;
            document.getElementById('totalPermissions').textContent = allPermissions.size;
        }

        // Inicializa√ß√£o
        function init() {
            processJsonData();
            updateStats();
            initFilters();
            renderTable();
        }

        // Executar quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
